
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bad√≠' App - Calendario Bah√°'√≠</title>
    
    <!-- Configuraci√≥n PWA Cr√≠tica -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#d97706">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./icon.png">
    <meta name="apple-mobile-web-app-title" content="Bad√≠' App">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        
        html {
            font-size: 18px;
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background-color: #f8fafc; 
            margin: 0; 
            padding: 0;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* Soporte para safe areas en iPhone */
        .safe-top {
            padding-top: max(12px, env(safe-area-inset-top));
        }
        
        .safe-bottom {
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .animate-fade-in { 
            animation: fadeIn 0.4s ease-out; 
        }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        /* Mejoras para inputs en m√≥vil */
        input[type="date"] {
            -webkit-appearance: none;
            appearance: none;
            font-size: 1rem;
        }
        
        input[type="date"]::-webkit-date-and-time-value {
            text-align: left;
        }
        
        /* Botones m√°s grandes para touch */
        button {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Cards con mejor sombra */
        .card-shadow {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 4px 16px rgba(0, 0, 0, 0.04);
        }
        
        /* Gradiente animado */
        .gradient-animate {
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Componente de Icono mejorado
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => { 
                if (window.lucide) window.lucide.createIcons(); 
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size, display: 'inline-block' }} className={className}></i>;
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [bhaiData, setBhaiData] = useState(null);
            const [sunTimes, setSunTimes] = useState(null);
            const [locationError, setLocationError] = useState(false);

            // Los 19 meses del calendario Bah√°'√≠
            const mesesBhai = [
                { n: "Bah√°", s: "Esplendor", g: "21 Mar" },
                { n: "Jal√°l", s: "Gloria", g: "9 Abr" },
                { n: "Jam√°l", s: "Belleza", g: "28 Abr" },
                { n: "‚ÄòAzamat", s: "Grandeza", g: "17 May" },
                { n: "N√∫r", s: "Luz", g: "5 Jun" },
                { n: "Rahmat", s: "Misericordia", g: "24 Jun" },
                { n: "Kalim√°t", s: "Palabras", g: "13 Jul" },
                { n: "Kam√°l", s: "Perfecci√≥n", g: "1 Ago" },
                { n: "Asm√°'", s: "Nombres", g: "20 Ago" },
                { n: "‚ÄòIzzat", s: "Fuerza", g: "8 Sep" },
                { n: "Mash√≠yyat", s: "Voluntad", g: "27 Sep" },
                { n: "‚ÄòIlm", s: "Conocimiento", g: "16 Oct" },
                { n: "Qudrat", s: "Poder", g: "4 Nov" },
                { n: "Qawl", s: "Discurso", g: "23 Nov" },
                { n: "Mas√°'il", s: "Preguntas", g: "12 Dic" },
                { n: "Sharaf", s: "Honor", g: "31 Dic" },
                { n: "Sult√°n", s: "Soberan√≠a", g: "19 Ene" },
                { n: "Mulk", s: "Dominio", g: "7 Feb" },
                { n: "‚ÄòAl√°", s: "Sublimidad", g: "2 Mar" }
            ];

            // Los 11 D√≠as Sagrados del calendario Bah√°'√≠
            const diasSagrados = [
                { n: "Naw-R√∫z", d: "21 de Marzo", s: "A√±o Nuevo Bah√°'√≠", t: "Suspende trabajo" },
                { n: "1er d√≠a de Ridv√°n", d: "21 de Abril", s: "Fiesta de Ridv√°n", t: "Suspende trabajo" },
                { n: "9no d√≠a de Ridv√°n", d: "29 de Abril", s: "Fiesta de Ridv√°n", t: "Suspende trabajo" },
                { n: "12vo d√≠a de Ridv√°n", d: "2 de Mayo", s: "Fiesta de Ridv√°n", t: "Suspende trabajo" },
                { n: "Declaraci√≥n del B√°b", d: "23 de Mayo", s: "Misi√≥n del B√°b", t: "Suspende trabajo" },
                { n: "Ascensi√≥n de Bah√°'u'll√°h", d: "29 de Mayo", s: "Fallecimiento", t: "Suspende trabajo" },
                { n: "Martirio del B√°b", d: "9 de Julio", s: "Sacrificio", t: "Suspende trabajo" },
                { n: "Nacimiento del B√°b", d: "Variable*", s: "Nacimiento", t: "Suspende trabajo" },
                { n: "Nacimiento de Bah√°'u'll√°h", d: "Variable*", s: "Nacimiento", t: "Suspende trabajo" },
                { n: "D√≠a del Convenio", d: "26 de Noviembre", s: "Convenio de Bah√°'u'll√°h", t: "No suspende trabajo" },
                { n: "Ascensi√≥n de 'Abdu'l-Bah√°", d: "28 de Noviembre", s: "Fallecimiento", t: "Conmemorativo" }
            ];

            const calculateBhaiDate = (dateStr) => {
                const dateObj = new Date(dateStr + "T12:00:00");
                const year = dateObj.getFullYear();
                let nawRuz = new Date(year, 2, 21);
                let startYear = year;
                
                if (dateObj < nawRuz) { 
                    startYear = year - 1; 
                    nawRuz = new Date(startYear, 2, 21); 
                }
                
                const diffDays = Math.floor(Math.abs(dateObj - nawRuz) / (1000 * 60 * 60 * 24));
                const bhaiYear = startYear - 1844 + 1;
                const ayyamDays = ((startYear % 4 === 0 && startYear % 100 !== 0) || (startYear % 400 === 0)) ? 5 : 4;
                
                let month, meaning, day;
                if (diffDays < 18 * 19) {
                    const idx = Math.floor(diffDays / 19);
                    month = mesesBhai[idx].n; 
                    meaning = mesesBhai[idx].s; 
                    day = (diffDays % 19) + 1;
                } else if (diffDays < 18 * 19 + ayyamDays) {
                    month = "Ayy√°m-i-H√°"; 
                    meaning = "D√≠as Intercalares"; 
                    day = (diffDays - 18 * 19) + 1;
                } else {
                    month = mesesBhai[18].n; 
                    meaning = mesesBhai[18].s; 
                    day = (diffDays - (18 * 19 + ayyamDays)) + 1;
                }
                
                return { day, month, meaning, year: bhaiYear };
            };

            const requestLocation = () => {
                setLocationError(false);
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (pos) => {
                            const times = SunCalc.getTimes(new Date(), pos.coords.latitude, pos.coords.longitude);
                            setSunTimes({
                                sunrise: times.sunrise.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                                sunset: times.sunset.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                            });
                        },
                        (error) => {
                            console.log('Error de ubicaci√≥n:', error);
                            setLocationError(true);
                        },
                        { enableHighAccuracy: false, timeout: 10000, maximumAge: 300000 }
                    );
                } else {
                    setLocationError(true);
                }
            };

            useEffect(() => {
                setBhaiData(calculateBhaiDate(new Date().toISOString().split('T')[0]));
                requestLocation();
                
                // Actualizar cada minuto
                const timer = setInterval(() => {
                    setBhaiData(calculateBhaiDate(new Date().toISOString().split('T')[0]));
                }, 60000);
                
                return () => clearInterval(timer);
            }, []);

            // Determinar si es de noche
            const currentHour = new Date().getHours();
            const isNight = currentHour >= 19 || currentHour < 6;

            return (
                <div className="flex flex-col min-h-screen bg-slate-50">
                    {/* Header */}
                    <header className="px-4 py-3 bg-white border-b border-slate-100 sticky top-0 z-50 safe-top">
                        <div className="flex items-center gap-3">
                            <div className="bg-gradient-to-br from-amber-500 to-orange-500 w-10 h-10 rounded-xl flex items-center justify-center text-white shadow-lg">
                                <Icon name="sun" size={22} />
                            </div>
                            <div>
                                <h1 className="font-extrabold text-xl text-slate-900 tracking-tight">Bad√≠' App</h1>
                                <p className="text-[11px] text-slate-400 font-medium">Calendario Bah√°'√≠</p>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 px-4 py-5 pb-28 max-w-xl mx-auto w-full overflow-y-auto no-scrollbar">
                        
                        {/* HOME TAB */}
                        {activeTab === 'home' && bhaiData && (
                            <div className="animate-fade-in space-y-5">
                                {/* Fecha principal */}
                                <div className="bg-gradient-to-br from-amber-500 via-orange-500 to-orange-600 gradient-animate rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
                                    <div className="absolute top-4 right-4 opacity-20">
                                        <Icon name={isNight ? "moon" : "sun"} size={80} />
                                    </div>
                                    
                                    <p className="text-amber-100 text-xs font-bold uppercase tracking-widest mb-2">Hoy es</p>
                                    
                                    <div className="flex items-end gap-3 mb-1">
                                        <h2 className="text-6xl font-black leading-none">{bhaiData.day}</h2>
                                        <span className="text-2xl font-semibold pb-1">{bhaiData.month}</span>
                                    </div>
                                    
                                    <p className="text-amber-50 text-base font-medium italic mb-6">"{bhaiData.meaning}"</p>
                                    
                                    <div className="pt-4 border-t border-white/20 flex justify-between items-end">
                                        <div>
                                            <p className="text-[11px] uppercase font-bold text-amber-200 tracking-wide">Era Bah√°'√≠</p>
                                            <p className="text-3xl font-black">{bhaiData.year} B.E.</p>
                                        </div>
                                        <div className="bg-white/20 px-3 py-2 rounded-xl text-sm font-bold backdrop-blur-sm">
                                            {isNight ? 'üåô Noche' : '‚òÄÔ∏è D√≠a'}
                                        </div>
                                    </div>
                                </div>

                                {/* Horarios solares */}
                                <div className="bg-slate-900 rounded-3xl p-5 text-white shadow-lg">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-amber-400 font-bold text-sm uppercase tracking-wide flex items-center gap-2">
                                            <Icon name="compass" size={18} /> Ciclo Solar Local
                                        </h3>
                                        <button 
                                            onClick={requestLocation}
                                            className="bg-white/10 p-2 rounded-full active:bg-white/20 transition-colors"
                                        >
                                            <Icon name="refresh-cw" size={16} />
                                        </button>
                                    </div>
                                    
                                    {sunTimes ? (
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-white/5 p-4 rounded-2xl border border-white/10 text-center">
                                                <Icon name="sunrise" size={28} className="mx-auto text-amber-300 mb-2" />
                                                <p className="text-[11px] font-semibold text-slate-400 uppercase tracking-wide">Amanecer</p>
                                                <p className="text-2xl font-black mt-1">{sunTimes.sunrise}</p>
                                            </div>
                                            <div className="bg-white/5 p-4 rounded-2xl border border-amber-500/30 text-center">
                                                <Icon name="sunset" size={28} className="mx-auto text-orange-400 mb-2" />
                                                <p className="text-[11px] font-semibold text-amber-500 uppercase tracking-wide">Ocaso</p>
                                                <p className="text-2xl font-black mt-1">{sunTimes.sunset}</p>
                                            </div>
                                        </div>
                                    ) : locationError ? (
                                        <div className="text-center py-6">
                                            <Icon name="map-pin-off" size={32} className="mx-auto text-slate-500 mb-2" />
                                            <p className="text-slate-400 text-sm">Activa la ubicaci√≥n para ver horarios</p>
                                            <button 
                                                onClick={requestLocation}
                                                className="mt-3 bg-amber-500 text-white px-4 py-2 rounded-xl font-bold text-sm active:bg-amber-600"
                                            >
                                                Activar ubicaci√≥n
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="text-center py-6">
                                            <div className="animate-pulse flex justify-center">
                                                <div className="bg-white/20 rounded-full p-3">
                                                    <Icon name="loader" size={24} />
                                                </div>
                                            </div>
                                            <p className="text-slate-400 text-sm mt-3">Obteniendo ubicaci√≥n...</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* CONVERTER TAB */}
                        {activeTab === 'converter' && (
                            <div className="animate-fade-in space-y-5">
                                <div className="bg-white rounded-3xl p-5 border border-slate-100 card-shadow">
                                    <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                                        <Icon name="calendar" size={22} className="text-amber-500" />
                                        Conversor de Fechas
                                    </h2>
                                    <input 
                                        type="date" 
                                        value={selectedDate} 
                                        onChange={(e) => setSelectedDate(e.target.value)}
                                        className="w-full bg-slate-50 border-2 border-slate-200 p-4 rounded-2xl font-bold text-slate-800 outline-none focus:border-amber-500 transition-colors text-base"
                                    />
                                </div>
                                
                                {selectedDate && (
                                    <div className="bg-slate-900 rounded-3xl p-6 text-white shadow-xl">
                                        <p className="text-amber-400 text-xs font-bold uppercase tracking-widest mb-2">Fecha Bah√°'√≠</p>
                                        <p className="text-4xl font-black leading-tight">
                                            {calculateBhaiDate(selectedDate).day} de {calculateBhaiDate(selectedDate).month}
                                        </p>
                                        <p className="text-amber-300 font-semibold italic text-lg mt-2">
                                            "{calculateBhaiDate(selectedDate).meaning}"
                                        </p>
                                        <div className="mt-4 pt-4 border-t border-white/10">
                                            <p className="text-slate-400 text-sm">A√±o Bah√°'√≠</p>
                                            <p className="text-2xl font-bold">{calculateBhaiDate(selectedDate).year} B.E.</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* HOLY DAYS TAB */}
                        {activeTab === 'holydays' && (
                            <div className="animate-fade-in space-y-3">
                                <div className="mb-4">
                                    <h2 className="text-xl font-bold text-slate-800">D√≠as Sagrados</h2>
                                    <p className="text-sm text-slate-500">11 d√≠as sagrados del a√±o Bah√°'√≠</p>
                                </div>
                                
                                {diasSagrados.map((ds, i) => (
                                    <div key={i} className="bg-white p-4 rounded-2xl border border-slate-100 flex items-start gap-4 card-shadow active:bg-slate-50 transition-colors">
                                        <div className="p-3 bg-gradient-to-br from-amber-100 to-orange-100 text-amber-600 rounded-xl shrink-0">
                                            <Icon name="star" size={22} />
                                        </div>
                                        <div className="flex-1 min-w-0">
                                            <p className="font-bold text-slate-800 text-base leading-tight">{ds.n}</p>
                                            <p className="text-sm text-amber-600 font-semibold mt-1">{ds.d}</p>
                                            <div className="flex items-center gap-2 mt-2">
                                                <span className="text-[11px] bg-slate-100 text-slate-600 px-2 py-1 rounded-lg font-medium">{ds.s}</span>
                                                <span className={`text-[11px] px-2 py-1 rounded-lg font-medium ${ds.t.includes('Suspende') ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-500'}`}>
                                                    {ds.t}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                
                                <p className="text-xs text-slate-400 text-center mt-4 px-4">
                                    * Los nacimientos del B√°b y Bah√°'u'll√°h var√≠an seg√∫n el calendario lunar. Consulta las fechas exactas para tu localidad.
                                </p>
                            </div>
                        )}

                        {/* MONTHS TAB */}
                        {activeTab === 'months' && (
                            <div className="animate-fade-in space-y-2">
                                <div className="mb-4">
                                    <h2 className="text-xl font-bold text-slate-800">Los 19 Meses</h2>
                                    <p className="text-sm text-slate-500">Cada mes tiene 19 d√≠as</p>
                                </div>
                                
                                {mesesBhai.map((m, i) => (
                                    <div key={i} className="bg-white p-4 rounded-2xl flex items-center gap-4 border border-slate-100 card-shadow active:bg-slate-50 transition-colors">
                                        <div className="w-12 h-12 bg-gradient-to-br from-slate-100 to-slate-50 flex items-center justify-center rounded-xl font-black text-base text-slate-700 shrink-0">
                                            {i + 1}
                                        </div>
                                        <div className="flex-1 min-w-0">
                                            <p className="font-bold text-slate-800 text-base">{m.n}</p>
                                            <p className="text-sm text-amber-600 font-semibold">{m.s}</p>
                                        </div>
                                        <span className="text-xs font-bold text-slate-400 bg-slate-50 px-2 py-1 rounded-lg shrink-0">
                                            {m.g}
                                        </span>
                                    </div>
                                ))}
                                
                                {/* Ayy√°m-i-H√° */}
                                <div className="bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-2xl border border-amber-200 mt-4">
                                    <div className="flex items-center gap-4">
                                        <div className="w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center rounded-xl text-white font-black text-base shrink-0">
                                            üéâ
                                        </div>
                                        <div className="flex-1">
                                            <p className="font-bold text-slate-800 text-base">Ayy√°m-i-H√°</p>
                                            <p className="text-sm text-amber-600 font-semibold">D√≠as Intercalares</p>
                                            <p className="text-xs text-slate-500 mt-1">4-5 d√≠as (seg√∫n a√±o bisiesto)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Bottom Navigation */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-slate-100 px-2 pt-2 pb-6 flex justify-around items-center z-50 safe-bottom">
                        {[
                            { id: 'home', icon: 'home', label: 'Inicio' },
                            { id: 'converter', icon: 'calendar', label: 'Conversor' },
                            { id: 'holydays', icon: 'heart', label: 'Sagrados' },
                            { id: 'months', icon: 'book-open', label: 'Meses' }
                        ].map(tab => (
                            <button 
                                key={tab.id} 
                                onClick={() => setActiveTab(tab.id)} 
                                className={`flex flex-col items-center gap-1 py-2 px-4 rounded-xl transition-all ${
                                    activeTab === tab.id 
                                        ? 'text-amber-600 bg-amber-50' 
                                        : 'text-slate-400 active:bg-slate-50'
                                }`}
                            >
                                <Icon name={tab.icon} size={26} />
                                <span className="text-[11px] font-bold">{tab.label}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // Registro del Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('‚úÖ Service Worker registrado:', reg.scope))
                    .catch(err => console.log('‚ùå Error al registrar SW:', err));
            });
        }
    </script>
</body>
</html>
